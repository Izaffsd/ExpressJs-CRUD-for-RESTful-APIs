# API Error Codes Reference Guide

## HTTP Status Codes

### Success Responses
| Status | Meaning | Use Case |
|--------|---------|----------|
| **200** | OK | GET request successful, data retrieved |
| **201** | Created | POST request successful, resource created |

### Client Errors (4xx)
| Status | Meaning | Use Case |
|--------|---------|----------|
| **400** | Bad Request | Invalid input, validation failed, missing fields |
| **404** | Not Found | Resource doesn't exist |
| **409** | Conflict | Duplicate entry, constraint violation |

### Server Errors (5xx)
| Status | Meaning | Use Case |
|--------|---------|----------|
| **503** | Service Unavailable | Database error, connection lost |

---

## Error Codes by Category

### Validation Errors (400)
```
REQUIRED_ERROR              - Missing required fields
INVALID_STUDENT_ID          - Invalid student ID format
INVALID_STUDENT_MATRIC      - Invalid matric number format
INVALID_EMAIL               - Invalid email format
INVALID_NO_KP               - Invalid No KP format
INVALID_COURSE_ID           - Invalid course ID format
INVALID_COURSE_CODE         - Invalid course code format
STUDENT_NOT_CREATED         - Insert operation failed (400)
COURSE_NOT_CREATED          - Insert operation failed (400)
```

### Not Found Errors (404)
```
STUDENT_NOT_FOUND           - Student with given ID doesn't exist
COURSE_NOT_FOUND            - Course with given ID/code doesn't exist
```

### Conflict Errors (409)
```
DUPLICATE_STUDENT           - Student record already exists (duplicate email/matric)
DUPLICATE_COURSE            - Course already exists (duplicate code)
DUPLICATE_COURSE_CODE       - Course code already exists during update
```

### Database/Server Errors (503)
```
STUDENT_FETCH_FAILED        - getAllStudents() database error
STUDENT_RETRIEVE_FAILED     - getStudentById() database error
STUDENT_CREATE_FAILED       - createStudent() database error
STUDENT_UPDATE_FAILED       - updateStudent() database error
STUDENT_DELETE_FAILED       - deleteStudent() database error

COURSE_FETCH_FAILED         - getAllCourses() database error
COURSE_RETRIEVE_FAILED      - getCourseByCode() database error
COURSE_CREATE_FAILED        - createCourse() database error
COURSE_UPDATE_FAILED        - updateCourse() database error
COURSE_DELETE_FAILED        - deleteCourse() database error
```

---

## Response Format

All responses follow this structure:

### Success Response
```json
{
  "statusCode": 200,
  "payload": [...data...],
  "message": "Operation successful",
  "success": true
}
```

### Error Response
```json
{
  "statusCode": 400,
  "errorCode": "VALIDATION_ERROR",
  "message": "Error description",
  "success": false
}
```

---

## Common Database Errors & Solutions

| Error Code 			| Database Error 		| Cause 				|							Solution |
|----------			|----------------		|-------				|----------|
| `DUPLICATE_STUDENT` 		| `ER_DUP_ENTRY` 		| Email or Matric No already exists 	| 		Check if student exists, use different values    |
| `STUDENT_FETCH_FAILED` 	| Connection lost 		| Database unavailable 			| 			     Check database connection status    |
| Data truncated 		| Column size exceeded 		| String too long for column 		|  		Verify input length matches column definition    |
| `ER_BAD_FIELD_ERROR` 		| Unknown column 'undefined' 	| Sending undefined/null in UPDATE	|Validate all fields before sending, don't send undefined values |
| `ER_NO_REFERENCED_ROW` 	| Foreign key constraint 	| Course ID doesn't exist 		| 		Ensure course exists before assigning to student |

---

## Error Handling Flow

### GET /students
- ✅ Success (200) → Returns array of students
- ❌ Database error (503) → STUDENT_FETCH_FAILED

### GET /students/:studentId
- ✅ Success (200) → Returns student object
- ❌ Invalid ID (400) → INVALID_STUDENT_ID
- ❌ Not found (404) → STUDENT_NOT_FOUND
- ❌ Database error (503) → STUDENT_RETRIEVE_FAILED

### POST /students
- ✅ Created (201) → Returns inserted data
- ❌ Missing fields (400) → REQUIRED_ERROR
- ❌ Invalid format (400) → INVALID_EMAIL, INVALID_MATRIC_NO, etc.
- ❌ Course doesn't exist (404) → COURSE_NOT_FOUND
- ❌ Duplicate entry (409) → DUPLICATE_STUDENT
- ❌ Database error (503) → STUDENT_CREATE_FAILED

### PUT /students/:studentId
- ✅ Updated (200) → Returns update result
- ❌ Missing fields (400) → REQUIRED_ERROR
- ❌ Invalid format (400) → INVALID_EMAIL, INVALID_MATRIC_NO, etc.
- ❌ Student not found (404) → STUDENT_NOT_FOUND
- ❌ Course doesn't exist (404) → COURSE_NOT_FOUND
- ❌ Duplicate entry (409) → DUPLICATE_STUDENT
- ❌ Database error (503) → STUDENT_UPDATE_FAILED

### DELETE /students/:studentId
- ✅ Deleted (200) → Returns delete result
- ❌ Invalid ID (400) → INVALID_STUDENT_ID
- ❌ Not found (404) → STUDENT_NOT_FOUND
- ❌ Database error (503) → STUDENT_DELETE_FAILED

---

## Frontend Implementation Notes

```javascript
// Example error handling in frontend
if (error.response?.data?.errorCode === 'DUPLICATE_STUDENT') {
    // Show: "This student already exists"
    showError('Student already registered');
} else if (error.response?.data?.errorCode === 'INVALID_EMAIL') {
    // Show: "Invalid email format"
    showError('Please enter a valid email');
} else if (error.response?.status === 503) {
    // Show: "Server temporarily unavailable"
    showError('Server is temporarily unavailable. Please try again later');
} else if (error.response?.status === 404) {
    // Show: "Resource not found"
    showError('Resource not found');
}
```

---

## Never Throw in Try-Catch

❌ **WRONG** - Crashes server:
```javascript
catch (error) {
    throw err // DO NOT DO THIS
}
```

✅ **CORRECT** - Handle gracefully:
```javascript
catch (error) {
    console.error('Error:', error)
    return response(503, null, 'Failed to create student', res, 'STUDENT_CREATE_FAILED')
}
```
